{% extends "base.html" %}
{% block body %}
  <nav
    class="block text-sm text-left text-green-800 h-12 flex items-center p-4 mb-5 border-2 border-gray-500"
    role="alert"
  >
    <ol class="list-reset flex text-grey-dark">
      <li><a href="/{{ lang }}" class="font-bold">{{home_locale}}</a></li>
    </ol>
  </nav>
  
  {% if request.session.user is defined %}
  <a href="/{{ lang }}/template" class="button flex-shrink-0 bg-green-500 hover:bg-green-700 border-green-500 hover:border-green-700 text-sm border-4 text-black py-1 px-2 rounded float-right">{{ add_template_locale }}</a>
  {% endif %}
  <h1 class="text-gray-700 font-semibold uppercase text-xl mb-7">{{ list_of_products_locale }}</h1>
  <hr class="my-3"/>
  <div class="space-y-4">
    {% for template in template_list %}
    <div class="shadow-lg p-4 bg-white relative overflow-hidden">
      <div class="flex items-center border-b-2 mb-2 py-2">
        <h2 class="text-gray-800 tracking-wider">{{ template.name }}</h2>
      </div>  
      <div class="container flex flex-row border-2 border-gray-300 space-y-6 p-5">
          <div class="bg-gray-100 rounded-lg h-auto p-4 flex flex-row justify-between divide-x divide-solid divide-gray-400">
              {% for scan in template.scans %}
              {% if scan.security_reports %}
              <div class="relative flex-1 flex flex-col gap-2 px-4">
                  <h3 class="text-gray-800 text-base font-semibold tracking-wider">
                    {% if request.session.user is not defined %}
                    <span>{{ scan.scan_type.name }}</span>
                    {% else %}
                    <a href="/{{ lang }}/results/{{ template.id }}/scan/{{ scan.id }}">{{ scan.scan_type.name }}</a>
                    {% endif %}
                  </h3>
                  <div class="container flex flex-row gap-1">
                    <div class="relative flex-1 flex flex-col gap-2">
                      <span class="font-semibold">{{ revisions_locale }}</span>
                      <div class="text-green-800 text-4xl font-bold">{{ scan.security_reports | length }}</div>
                    </div>
                    <div class="relative flex-1 flex flex-col gap-2">
                      <span class="font-semibold">{{ violations_locale }}</span>
                      <div class="text-green-800 text-4xl font-bold">{{ scan.security_reports[0].security_violations | length }}</div>
                    </div>
                    {% if scan.security_reports | length > 1 and scan.security_reports[0].security_violations | length > 0 %}
                    {% set delta = (((scan.security_reports[0].security_violations | length - scan.security_reports[1].security_violations | length) / scan.security_reports[0].security_violations | length) * 100)|int %}
                    <div class="absolute bg-red-400 rounded-md font-semibold text-xs text-gray-100 p-2 right-0 bottom-0">
                      {% if delta > 0  %}
                      +
                      {% elif delta < 0 %}
                      -
                      {% endif %}
                      {{ delta | abs }}%
                    </div>
                    {% endif %}
                  </div>  
              </div>
              {% endif %}
              {% if scan.a11y_reports %}
              <div class="relative flex-1 flex flex-col gap-2 px-4">
                <div class="text-gray-800 text-base font-semibold tracking-wider">
                  {% if request.session.user is not defined %}
                  <span>{{ scan.scan_type.name }}</span>
                  {% else %}
                  <a href="/{{ lang }}/results/{{ template.id }}/scan/{{ scan.id }}">{{ scan.scan_type.name }}</a>
                  {% endif %}
                </div>
                  <div class="container flex flex-row gap-1">
                    <div class="relative flex-1 flex flex-col gap-2">
                      <span class="font-semibold">{{ revisions_locale }}</span>
                      <div class="text-green-800 text-4xl font-bold">{{ scan.a11y_reports | length }}</div>
                    </div>
                    <div class="relative flex-1 flex flex-col gap-2">
                      <span class="font-semibold">{{ violations_locale }}</span>
                      <div class="text-green-800 text-4xl font-bold">{{ scan.a11y_reports[0].a11y_violations | length }}</div>
                    </div>
                    {% if scan.a11y_reports | length > 1 and scan.a11y_reports[0].a11y_violations | length > 0 %}
                    {% set a11y_delta = (((scan.a11y_reports[0].a11y_violations | length - scan.a11y_reports[1].a11y_violations | length) / scan.a11y_reports[0].a11y_violations | length) * 100)|int %}
                    <div class="absolute bg-red-400 rounded-md font-semibold text-xs text-gray-100 p-2 right-0 bottom-0">
                      {% if a11y_delta > 0  %}
                      +
                      {% elif a11y_delta < 0 %}
                      -
                      {% endif %}
                      {{ a11y_delta | abs }}%
                    </div>
                    {% endif %}
                  </div>  
              </div>
              {% endif %}
              {% endfor %}            
          </div>
      </div>
    </div>
  {% endfor %}
  </div>
</div>

  {% block footer %}
  {{super()}}
  {% endblock %}
{% endblock %}